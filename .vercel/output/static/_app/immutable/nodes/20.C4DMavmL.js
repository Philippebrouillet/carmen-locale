import{P as ie}from"../chunks/public.BeJSVsf1.js";import{c as ue}from"../chunks/clock.svelte.pa43Gjrj.js";import{t as K,g as Ne}from"../chunks/formater.C10dx8Nx.js";import{s as x,e as I,t as W,a as B,c as S,b as H,d as J,f as y,g as L,q as oe,m as E,i as V,h as D,S as G,j as ee,n as Y,I as Q,w as Se,k as Me,J as $,U as He,Y as Ae,B as he,r as Be,V as Le,ae as Oe,l as ce}from"../chunks/scheduler.BoY_d1jh.js";import{S as te,i as le,c as ne,b as re,m as ae,a as F,t as q,d as se,h as Ve,f as X,g as Z}from"../chunks/index.C5ymHmkt.js";import{e as R,u as Ue,o as Fe}from"../chunks/each.VpouubDL.js";async function qe({fetch:r,params:e,parent:t}){e.slug;let l=await t(),n=new Date;ue.subscribe(c=>n=new Date(c)),n.setDate(1);let s=new Date(n);s.setMonth(n.getMonth()+1),K(n),K(s);let i=l.locationInfo.location,d=`${ie}/admin/calendars?location=${i.id}`,_=await r(d,{credentials:"include"});if(!_.ok)return{planning:[],tickets:[]};let a=await _.json(),o=l.locationInfo.tickets??[];return{planning:a,tickets:o.map(c=>({id:c.id,workerId:c.workerId,durationS:c.durationS,canceledTime:c.canceledTime?new Date(c.canceledTime*1e3):null,doneTime:c.doneTime?new Date(c.doneTime*1e3):null,rdvTime:c.rdvTime?new Date(c.rdvTime*1e3):null,startedTime:c.startedTime?new Date(c.startedTime*1e3):null,details:c.details}))}}const dt=Object.freeze(Object.defineProperty({__proto__:null,load:qe},Symbol.toStringTag,{value:"Module"}));function _e(r,e,t){const l=r.slice();return l[13]=e[t],l}function ge(r,e,t){const l=r.slice();return l[16]=e[t],l}function me(r){let e,t=r[16]+"",l;return{c(){e=I("div"),l=W(t),this.h()},l(n){e=S(n,"DIV",{class:!0});var s=H(e);l=J(s,t),s.forEach(y),this.h()},h(){E(e,"class","week-day svelte-1hma2ik")},m(n,s){V(n,e,s),D(e,l)},p:Y,d(n){n&&y(e)}}}function pe(r){let e,t,l=r[13].getDate().toString().padStart(2,"0")+"",n,s,i,d;function _(){return r[10](r[13])}return{c(){e=I("button"),t=I("span"),n=W(l),s=B(),this.h()},l(a){e=S(a,"BUTTON",{class:!0});var o=H(e);t=S(o,"SPAN",{});var g=H(t);n=J(g,l),g.forEach(y),s=L(o),o.forEach(y),this.h()},h(){E(e,"class","day svelte-1hma2ik"),$(e,"enabled",r[13].getMonth()==r[2].getMonth()),$(e,"active",r[6](r[13],r[0]))},m(a,o){V(a,e,o),D(e,t),D(t,n),D(e,s),i||(d=G(e,"click",_),i=!0)},p(a,o){r=a,o&8&&l!==(l=r[13].getDate().toString().padStart(2,"0")+"")&&ee(n,l),o&12&&$(e,"enabled",r[13].getMonth()==r[2].getMonth()),o&73&&$(e,"active",r[6](r[13],r[0]))},d(a){a&&y(e),i=!1,d()}}}function je(r){let e,t,l="<",n,s,i,d=r[2].toLocaleString("default",{month:"long",year:"numeric"})+"",_,a,o,g=">",c,v,u,k="today",h,b,U,p,w,M=R(r[5]),C=[];for(let T=0;T<M.length;T+=1)C[T]=me(ge(r,M,T));let A=R(r[3]),f=[];for(let T=0;T<A.length;T+=1)f[T]=pe(_e(r,A,T));return{c(){e=I("nav"),t=I("button"),n=W(l),s=B(),i=I("div"),_=W(d),a=B(),o=I("button"),c=W(g),v=B(),u=I("button"),u.textContent=k,h=B(),b=I("div");for(let T=0;T<C.length;T+=1)C[T].c();U=B();for(let T=0;T<f.length;T+=1)f[T].c();this.h()},l(T){e=S(T,"NAV",{class:!0});var N=H(e);t=S(N,"BUTTON",{});var m=H(t);n=J(m,l),m.forEach(y),s=L(N),i=S(N,"DIV",{class:!0});var P=H(i);_=J(P,d),P.forEach(y),a=L(N),o=S(N,"BUTTON",{});var j=H(o);c=J(j,g),j.forEach(y),v=L(N),u=S(N,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(u)!=="svelte-lqvkty"&&(u.textContent=k),N.forEach(y),h=L(T),b=S(T,"DIV",{class:!0});var O=H(b);for(let z=0;z<C.length;z+=1)C[z].l(O);U=L(O);for(let z=0;z<f.length;z+=1)f[z].l(O);O.forEach(y),this.h()},h(){E(i,"class","date svelte-1hma2ik"),E(u,"class","today svelte-1hma2ik"),E(e,"class","svelte-1hma2ik"),E(b,"class","calendar svelte-1hma2ik")},m(T,N){V(T,e,N),D(e,t),D(t,n),D(e,s),D(e,i),D(i,_),D(e,a),D(e,o),D(o,c),D(e,v),D(e,u),V(T,h,N),V(T,b,N);for(let m=0;m<C.length;m+=1)C[m]&&C[m].m(b,null);D(b,U);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(b,null);p||(w=[G(t,"click",r[7]),G(o,"click",r[8]),G(u,"click",r[9])],p=!0)},p(T,[N]){if(N&4&&d!==(d=T[2].toLocaleString("default",{month:"long",year:"numeric"})+"")&&ee(_,d),N&32){M=R(T[5]);let m;for(m=0;m<M.length;m+=1){const P=ge(T,M,m);C[m]?C[m].p(P,N):(C[m]=me(P),C[m].c(),C[m].m(b,U))}for(;m<C.length;m+=1)C[m].d(1);C.length=M.length}if(N&77){A=R(T[3]);let m;for(m=0;m<A.length;m+=1){const P=_e(T,A,m);f[m]?f[m].p(P,N):(f[m]=pe(P),f[m].c(),f[m].m(b,null))}for(;m<f.length;m+=1)f[m].d(1);f.length=A.length}},i:Y,o:Y,d(T){T&&(y(e),y(h),y(b)),Q(C,T),Q(f,T),p=!1,Se(w)}}}function Re(r,e,t){let l,n;Me(r,ue,h=>t(4,n=h));const s=24*3600*1e3,i=["L","M","M","J","V","S","D"];let{selected:d=new Date(n)}=e,_=0,a=new Date(d);function o(h){t(1,_=h),a.setFullYear(d.getFullYear(),d.getMonth()+_),t(2,a);let b=new Date(a);b.setDate(1);let p=(b.getDay()+6)%7,w=new Date(b.getTime()-p*s),M=[];for(let C=0;C<7*6;C++){let A=new Date(w.getTime()+C*s);M.push(A)}return M}function g(h,b){return Math.floor(h.getTime()/s)==Math.floor(b.getTime()/s)}const c=()=>t(1,_=_-1),v=()=>t(1,_=_+1),u=()=>{t(1,_=0),t(0,d=new Date(n))},k=h=>t(0,d=h);return r.$$set=h=>{"selected"in h&&t(0,d=h.selected)},r.$$.update=()=>{r.$$.dirty&2&&t(3,l=o(_))},[d,_,a,l,n,i,g,c,v,u,k]}class We extends te{constructor(e){super(),le(this,e,Re,je,x,{selected:0})}}function ve(r){let e,t,l;return{c(){e=I("div"),t=W(r[2]),l=W("%"),this.h()},l(n){e=S(n,"DIV",{class:!0,style:!0});var s=H(e);t=J(s,r[2]),l=J(s,"%"),s.forEach(y),this.h()},h(){E(e,"class","progressbar svelte-82b5r"),He(e,"whidth",r[2]+"%"),$(e,"full",r[0]==1)},m(n,s){V(n,e,s),D(e,t),D(e,l)},p(n,s){s&1&&$(e,"full",n[0]==1)},d(n){n&&y(e)}}}function Je(r){let e,t=!r[1]&&ve(r);return{c(){e=I("div"),t&&t.c(),this.h()},l(l){e=S(l,"DIV",{class:!0});var n=H(e);t&&t.l(n),n.forEach(y),this.h()},h(){E(e,"class","progressbar-wrapper svelte-82b5r")},m(l,n){V(l,e,n),t&&t.m(e,null)},p(l,[n]){l[1]?t&&(t.d(1),t=null):t?t.p(l,n):(t=ve(l),t.c(),t.m(e,null))},i:Y,o:Y,d(l){l&&y(e),t&&t.d()}}}function Ye(r,e,t){let{value:l=0}=e,{disabled:n=!1}=e,s=Math.floor(l*100);return r.$$set=i=>{"value"in i&&t(0,l=i.value),"disabled"in i&&t(1,n=i.disabled)},[l,n,s]}class Pe extends te{constructor(e){super(),le(this,e,Ye,Je,x,{value:0,disabled:1})}}function ze(r){let e,t,l,n,s,i;return{c(){e=I("label"),t=I("input"),l=B(),n=I("span"),this.h()},l(d){e=S(d,"LABEL",{class:!0});var _=H(e);t=S(_,"INPUT",{type:!0,class:!0}),l=L(_),n=S(_,"SPAN",{class:!0}),H(n).forEach(y),_.forEach(y),this.h()},h(){E(t,"type","checkbox"),t.checked=r[0],E(t,"class","svelte-1fqr7n"),E(n,"class","slider round svelte-1fqr7n"),E(e,"class","switch svelte-1fqr7n")},m(d,_){V(d,e,_),D(e,t),D(e,l),D(e,n),s||(i=G(t,"change",r[1]),s=!0)},p(d,[_]){_&1&&(t.checked=d[0])},i:Y,o:Y,d(d){d&&y(e),s=!1,i()}}}function Ge(r,e,t){let{value:l}=e;function n(s){Ae.call(this,r,s)}return r.$$set=s=>{"value"in s&&t(0,l=s.value)},[l,n]}class $e extends te{constructor(e){super(),le(this,e,Ge,ze,x,{value:0})}}function Ke(r){let e,t,l,n,s,i,d=r[0].name+"",_,a,o,g,c="DÃ©but :",v,u,k,h,b,U="Fin :",p,w,M,C,A,f,T,N;return A=new $e({props:{value:r[4]}}),A.$on("change",r[10]),{c(){e=I("div"),t=I("img"),s=B(),i=I("div"),_=W(d),a=B(),o=I("div"),g=I("label"),g.textContent=c,v=B(),u=I("input"),h=B(),b=I("label"),b.textContent=U,p=B(),w=I("input"),C=B(),ne(A.$$.fragment),this.h()},l(m){e=S(m,"DIV",{class:!0});var P=H(e);t=S(P,"IMG",{alt:!0,src:!0,height:!0,width:!0,class:!0}),s=L(P),i=S(P,"DIV",{class:!0});var j=H(i);_=J(j,d),j.forEach(y),a=L(P),o=S(P,"DIV",{class:!0});var O=H(o);g=S(O,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),oe(g)!=="svelte-doxqqm"&&(g.textContent=c),v=L(O),u=S(O,"INPUT",{id:!0,type:!0,step:!0}),h=L(O),b=S(O,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),oe(b)!=="svelte-1wblno2"&&(b.textContent=U),p=L(O),w=S(O,"INPUT",{id:!0,type:!0,step:!0}),O.forEach(y),C=L(P),re(A.$$.fragment,P),P.forEach(y),this.h()},h(){E(t,"alt",l=r[0].name),he(t.src,n=r[0].avatar)||E(t,"src",n),E(t,"height","40"),E(t,"width","40"),E(t,"class","svelte-18lcvct"),E(i,"class","name svelte-18lcvct"),E(g,"for","start"),E(g,"class","svelte-18lcvct"),E(u,"id","start"),E(u,"type","time"),u.value=r[2],u.disabled=k=r[1]==null,E(u,"step","120"),E(b,"for","end"),E(b,"class","svelte-18lcvct"),E(w,"id","end"),E(w,"type","time"),w.disabled=M=r[1]==null,w.value=r[3],E(w,"step","120"),E(o,"class","worker-times svelte-18lcvct"),E(e,"class","worker-status svelte-18lcvct")},m(m,P){V(m,e,P),D(e,t),D(e,s),D(e,i),D(i,_),D(e,a),D(e,o),D(o,g),D(o,v),D(o,u),D(o,h),D(o,b),D(o,p),D(o,w),D(e,C),ae(A,e,null),f=!0,T||(N=[G(u,"change",r[8]),G(w,"change",r[9])],T=!0)},p(m,[P]){(!f||P&1&&l!==(l=m[0].name))&&E(t,"alt",l),(!f||P&1&&!he(t.src,n=m[0].avatar))&&E(t,"src",n),(!f||P&1)&&d!==(d=m[0].name+"")&&ee(_,d),(!f||P&4&&u.value!==m[2])&&(u.value=m[2]),(!f||P&2&&k!==(k=m[1]==null))&&(u.disabled=k),(!f||P&2&&M!==(M=m[1]==null))&&(w.disabled=M),(!f||P&8&&w.value!==m[3])&&(w.value=m[3]);const j={};P&16&&(j.value=m[4]),A.$set(j)},i(m){f||(F(A.$$.fragment,m),f=!0)},o(m){q(A.$$.fragment,m),f=!1},d(m){m&&y(e),se(A),T=!1,Se(N)}}}function ke(r){let e=r.getHours().toString().padStart(2,"0"),t=r.getMinutes().toString().padStart(2,"0");return`${e}:${t}`}function Qe(r,e,t){let{worker:l}=e,{planning:n=null}=e,s=(n&&ke(new Date(n.startTime)))??null,i=(n&&ke(new Date(n.endTime)))??null,d=(n==null?void 0:n.enabled)??!1;const _=Be();function a(){_("timeChange",{planning:n,startTime:s,endTime:i})}function o(){_("statusChange",{planning:n,enabled:d})}function g(){_("create",{worker:l})}const c=k=>{k.currentTarget.value!=null&&(t(2,s=k.currentTarget.value),a())},v=k=>{k.currentTarget.value!=null&&(t(3,i=k.currentTarget.value),a())},u=k=>{if(n==null){g();return}t(4,d=!d),o()};return r.$$set=k=>{"worker"in k&&t(0,l=k.worker),"planning"in k&&t(1,n=k.planning)},[l,n,s,i,d,a,o,g,c,v,u]}class Xe extends te{constructor(e){super(),le(this,e,Qe,Ke,x,{worker:0,planning:1})}}function be(r,e,t){const l=r.slice();return l[21]=e[t],l}function Te(r,e,t){const l=r.slice();return l[24]=e[t],l}function we(r,e,t){const l=r.slice();return l[27]=e[t],l}function De(r,e,t){const l=r.slice();return l[24]=e[t],l}function ye(r,e){let t,l,n;function s(...i){return e[16](e[24],...i)}return l=new Xe({props:{worker:e[24],planning:e[4].find(s)??null}}),l.$on("create",e[17]),l.$on("statusChange",e[18]),l.$on("timeChange",e[19]),{key:r,first:null,c(){t=ce(),ne(l.$$.fragment),this.h()},l(i){t=ce(),re(l.$$.fragment,i),this.h()},h(){this.first=t},m(i,d){V(i,t,d),ae(l,i,d),n=!0},p(i,d){e=i;const _={};d[0]&4&&(_.worker=e[24]),d[0]&20&&(_.planning=e[4].find(s)??null),l.$set(_)},i(i){n||(F(l.$$.fragment,i),n=!0)},o(i){q(l.$$.fragment,i),n=!1},d(i){i&&y(t),se(l,i)}}}function Ze(r){let e,t,l,n,s,i,d,_,a=R(r[3]),o=[];for(let u=0;u<a.length;u+=1)o[u]=Ee(we(r,a,u));let g=R(r[5]),c=[];for(let u=0;u<g.length;u+=1)c[u]=Ie(be(r,g,u));const v=u=>q(c[u],1,1,()=>{c[u]=null});return{c(){e=I("table"),t=I("thead"),l=I("tr"),n=I("th"),s=B();for(let u=0;u<o.length;u+=1)o[u].c();i=B(),d=I("tbody");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){e=S(u,"TABLE",{class:!0});var k=H(e);t=S(k,"THEAD",{});var h=H(t);l=S(h,"TR",{class:!0});var b=H(l);n=S(b,"TH",{class:!0}),H(n).forEach(y),s=L(b);for(let p=0;p<o.length;p+=1)o[p].l(b);b.forEach(y),h.forEach(y),i=L(k),d=S(k,"TBODY",{});var U=H(d);for(let p=0;p<c.length;p+=1)c[p].l(U);U.forEach(y),k.forEach(y),this.h()},h(){E(n,"class","range svelte-530vro"),E(l,"class","svelte-530vro"),E(e,"class","svelte-530vro")},m(u,k){V(u,e,k),D(e,t),D(t,l),D(l,n),D(l,s);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(l,null);D(e,i),D(e,d);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(d,null);_=!0},p(u,k){if(k[0]&8){a=R(u[3]);let h;for(h=0;h<a.length;h+=1){const b=we(u,a,h);o[h]?o[h].p(b,k):(o[h]=Ee(b),o[h].c(),o[h].m(l,null))}for(;h<o.length;h+=1)o[h].d(1);o.length=a.length}if(k[0]&40){g=R(u[5]);let h;for(h=0;h<g.length;h+=1){const b=be(u,g,h);c[h]?(c[h].p(b,k),F(c[h],1)):(c[h]=Ie(b),c[h].c(),F(c[h],1),c[h].m(d,null))}for(Z(),h=g.length;h<c.length;h+=1)v(h);X()}},i(u){if(!_){for(let k=0;k<g.length;k+=1)F(c[k]);_=!0}},o(u){c=c.filter(Boolean);for(let k=0;k<c.length;k+=1)q(c[k]);_=!1},d(u){u&&y(e),Q(o,u),Q(c,u)}}}function xe(r){let e,t="FERMER";return{c(){e=I("div"),e.textContent=t},l(l){e=S(l,"DIV",{"data-svelte-h":!0}),oe(e)!=="svelte-1crgedd"&&(e.textContent=t)},m(l,n){V(l,e,n)},p:Y,i:Y,o:Y,d(l){l&&y(e)}}}function Ee(r){let e,t=r[27].worker.name+"",l;return{c(){e=I("th"),l=W(t),this.h()},l(n){e=S(n,"TH",{class:!0});var s=H(e);l=J(s,t),s.forEach(y),this.h()},h(){E(e,"class","worker svelte-530vro")},m(n,s){V(n,e,s),D(e,l)},p(n,s){s[0]&8&&t!==(t=n[27].worker.name+"")&&ee(l,t)},d(n){n&&y(e)}}}function et(r){let e,t,l;return t=new Pe({props:{disabled:!0}}),{c(){e=I("td"),ne(t.$$.fragment),this.h()},l(n){e=S(n,"TD",{class:!0});var s=H(e);re(t.$$.fragment,s),s.forEach(y),this.h()},h(){E(e,"class","worker disabled svelte-530vro")},m(n,s){V(n,e,s),ae(t,e,null),l=!0},i(n){l||(F(t.$$.fragment,n),l=!0)},o(n){q(t.$$.fragment,n),l=!1},d(n){n&&y(e),se(t)}}}function tt(r){let e,t,l;return t=new Pe({props:{value:0}}),{c(){e=I("td"),ne(t.$$.fragment),this.h()},l(n){e=S(n,"TD",{class:!0});var s=H(e);re(t.$$.fragment,s),s.forEach(y),this.h()},h(){E(e,"class","worker svelte-530vro")},m(n,s){V(n,e,s),ae(t,e,null),l=!0},i(n){l||(F(t.$$.fragment,n),l=!0)},o(n){q(t.$$.fragment,n),l=!1},d(n){n&&y(e),se(t)}}}function Ce(r){let e,t,l,n,s;const i=[tt,et],d=[];function _(a,o){return o[0]&40&&(e=null),e==null&&(e=!!(a[24].planning&&new Date(a[24].planning.startTime).getTime()<=a[21].getTime())),e?0:1}return t=_(r,[-1,-1]),l=d[t]=i[t](r),{c(){l.c(),n=ce()},l(a){l.l(a),n=ce()},m(a,o){d[t].m(a,o),V(a,n,o),s=!0},p(a,o){let g=t;t=_(a,o),t!==g&&(Z(),q(d[g],1,1,()=>{d[g]=null}),X(),l=d[t],l||(l=d[t]=i[t](a),l.c()),F(l,1),l.m(n.parentNode,n))},i(a){s||(F(l),s=!0)},o(a){q(l),s=!1},d(a){a&&y(n),d[t].d(a)}}}function Ie(r){let e,t,l=r[21].toLocaleTimeString("FR",{hour:"2-digit",minute:"2-digit"})+"",n,s,i,d,_=R(r[3]),a=[];for(let g=0;g<_.length;g+=1)a[g]=Ce(Te(r,_,g));const o=g=>q(a[g],1,1,()=>{a[g]=null});return{c(){e=I("tr"),t=I("td"),n=W(l),s=B();for(let g=0;g<a.length;g+=1)a[g].c();i=B(),this.h()},l(g){e=S(g,"TR",{class:!0});var c=H(e);t=S(c,"TD",{class:!0});var v=H(t);n=J(v,l),v.forEach(y),s=L(c);for(let u=0;u<a.length;u+=1)a[u].l(c);i=L(c),c.forEach(y),this.h()},h(){E(t,"class","range svelte-530vro"),E(e,"class","svelte-530vro")},m(g,c){V(g,e,c),D(e,t),D(t,n),D(e,s);for(let v=0;v<a.length;v+=1)a[v]&&a[v].m(e,null);D(e,i),d=!0},p(g,c){if((!d||c[0]&32)&&l!==(l=g[21].toLocaleTimeString("FR",{hour:"2-digit",minute:"2-digit"})+"")&&ee(n,l),c[0]&40){_=R(g[3]);let v;for(v=0;v<_.length;v+=1){const u=Te(g,_,v);a[v]?(a[v].p(u,c),F(a[v],1)):(a[v]=Ce(u),a[v].c(),F(a[v],1),a[v].m(e,i))}for(Z(),v=_.length;v<a.length;v+=1)o(v);X()}},i(g){if(!d){for(let c=0;c<_.length;c+=1)F(a[c]);d=!0}},o(g){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)q(a[c]);d=!1},d(g){g&&y(e),Q(a,g)}}}function lt(r){let e,t,l,n,s,i=[],d=new Map,_,a,o,g;function c(p){r[15](p)}let v={};r[1]!==void 0&&(v.selected=r[1]),l=new We({props:v}),Le.push(()=>Ve(l,"selected",c));let u=R(r[2]);const k=p=>p[24].id;for(let p=0;p<u.length;p+=1){let w=De(r,u,p),M=k(w);d.set(M,i[p]=ye(M,w))}const h=[xe,Ze],b=[];function U(p,w){return p[3].length==0?0:1}return a=U(r),o=b[a]=h[a](r),{c(){e=I("main"),t=I("div"),ne(l.$$.fragment),s=B();for(let p=0;p<i.length;p+=1)i[p].c();_=B(),o.c(),this.h()},l(p){e=S(p,"MAIN",{class:!0});var w=H(e);t=S(w,"DIV",{class:!0});var M=H(t);re(l.$$.fragment,M),s=L(M);for(let C=0;C<i.length;C+=1)i[C].l(M);M.forEach(y),_=L(w),o.l(w),w.forEach(y),this.h()},h(){E(t,"class","column svelte-530vro"),E(e,"class","svelte-530vro")},m(p,w){V(p,e,w),D(e,t),ae(l,t,null),D(t,s);for(let M=0;M<i.length;M+=1)i[M]&&i[M].m(t,null);D(e,_),b[a].m(e,null),g=!0},p(p,w){const M={};!n&&w[0]&2&&(n=!0,M.selected=p[1],Oe(()=>n=!1)),l.$set(M),w[0]&471&&(u=R(p[2]),Z(),i=Ue(i,w,k,1,p,u,d,t,Fe,ye,null,De),X());let C=a;a=U(p),a===C?b[a].p(p,w):(Z(),q(b[C],1,1,()=>{b[C]=null}),X(),o=b[a],o?o.p(p,w):(o=b[a]=h[a](p),o.c()),F(o,1),o.m(e,null))},i(p){if(!g){F(l.$$.fragment,p);for(let w=0;w<u.length;w+=1)F(i[w]);F(o),g=!0}},o(p){q(l.$$.fragment,p);for(let w=0;w<i.length;w+=1)q(i[w]);q(o),g=!1},d(p){p&&y(e),se(l);for(let w=0;w<i.length;w+=1)i[w].d();b[a].d()}}}function nt(r,e,t){return r.filter(n=>n.workerId==e.id)}function rt(r,e){let t=[];if(r==null||e==null)return t;const l=3600*1e3;for(let n=r.getTime();n<e.getTime();n+=l/2){let s=new Date(n);s.setSeconds(0),t.push(s)}return t}function at(r,e,t){let l,n,s,i,d,_,a,o,g;Me(r,ue,f=>t(20,g=f));let{data:c}=e,v=new Date(g),u=[],k=[];async function h(f,T,N,m){if(N==null||m==null)return;K(T);let[P,j]=N.split(":"),[O,z]=m.split(":"),fe=new Date(v);fe.setHours(+P,+j);let de=new Date(v);de.setHours(+O,+z),fetch(`${ie}/admin/calendars/${f}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({startTime:Math.floor(fe.getTime()/1e3),endTime:Math.floor(de.getTime()/1e3)})})}async function b(f,T,N){let m=N.getUTCFullYear(),P=Ne(N),j=new Date(N);j.setHours(9,0,0,0);let O=new Date(N);O.setHours(18,0,0,0),fetch(`${ie}/admin/calendars`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({workerId:T.id,locationId:f.id,day:[m,P],startTime:Math.floor(j.getTime()/1e3),endTime:Math.floor(O.getTime()/1e3),enabled:!0})})}async function U(f,T){fetch(`${ie}/admin/calendars/${f}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:T})})}function p(f){v=f,t(1,v)}const w=(f,T)=>T.workerId==f.id,M=f=>b(c.locationInfo.location,f.detail.worker,v),C=f=>U(f.detail.planning.id,f.detail.enabled),A=f=>h(f.detail.planning.id,v,f.detail.startTime,f.detail.endTime);return r.$$set=f=>{"data"in f&&t(0,c=f.data)},r.$$.update=()=>{r.$$.dirty[0]&1&&t(2,u=c.locationInfo.workers),r.$$.dirty[0]&1&&t(14,l=c.planning),r.$$.dirty[0]&1&&t(13,n=c.tickets),r.$$.dirty[0]&16386&&t(4,s=l.filter(f=>f.day[0]==K(v)[0]&&f.day[1]==K(v)[1])??[]),r.$$.dirty[0]&8214&&t(3,k=u.map(f=>{let T=s.find(N=>N.workerId==f.id)??null;return{worker:f,planning:T,tickets:nt(n,f)}}).filter(f=>f.planning&&f.planning.enabled||f.tickets.length>0)),r.$$.dirty[0]&8&&t(12,i=k.map(f=>f.planning?new Date(f.planning.startTime).getTime():null).filter(f=>f!=null)),r.$$.dirty[0]&8&&t(11,d=k.map(f=>f.planning?new Date(f.planning.endTime).getTime():null).filter(f=>f!=null)),r.$$.dirty[0]&4096&&t(10,_=new Date(Math.min(...i))),r.$$.dirty[0]&2048&&t(9,a=new Date(Math.max(...d))),r.$$.dirty[0]&1536&&t(5,o=rt(_,a))},[c,v,u,k,s,o,h,b,U,a,_,d,i,n,l,p,w,M,C,A]}class ht extends te{constructor(e){super(),le(this,e,at,lt,x,{data:0},null,[-1,-1])}}export{ht as component,dt as universal};
